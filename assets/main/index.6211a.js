window.__require=function e(t,o,n){function r(c,s){if(!o[c]){if(!t[c]){var u=c.split("/");if(u=u[u.length-1],!t[u]){var l="function"==typeof __require&&__require;if(!s&&l)return l(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+c+"'")}c=u}var a=o[c]={exports:{}};t[c][0].call(a.exports,function(e){return r(t[c][1][e]||e)},a,a.exports,e,t,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({BigBoom:[function(e,t,o){"use strict";cc._RF.push(t,"891ebz+ilVECKAFRc6T1LTv","BigBoom");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,u=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.endAnimation=function(){this.node.destroy()},i([s],t)}(cc.Component));o.default=u,cc._RF.pop()},{}],BombBlock:[function(e,t,o){"use strict";cc._RF.push(t,"059f8ND+xFBkr6qPfNa4OLy","BombBlock"),Object.defineProperty(o,"__esModule",{value:!0}),o.BombBlock=void 0;var n=e("../enums/gameEvent"),r=function(){function e(){}return e.prototype.interact=function(e,t,o){var r=new Array;return r.push(t.getGridBlock(e.row,e.col-1)),r.push(t.getGridBlock(e.row+1,e.col-1)),r.push(t.getGridBlock(e.row+1,e.col)),r.push(t.getGridBlock(e.row+1,e.col+1)),r.push(t.getGridBlock(e.row,e.col+1)),r.push(t.getGridBlock(e.row-1,e.col+1)),r.push(t.getGridBlock(e.row-1,e.col)),r.push(t.getGridBlock(e.row-1,e.col-1)),null==o||o.emit(n.GAMEEVENT.BOMB_ANIMATION,e),r.filter(function(e){return null!=e})},e}();o.BombBlock=r,cc._RF.pop()},{"../enums/gameEvent":"gameEvent"}],NormalBlock:[function(e,t,o){"use strict";cc._RF.push(t,"aabe6kHP1ZJIqpBXVIl9/xE","NormalBlock"),Object.defineProperty(o,"__esModule",{value:!0}),o.NormalBlock=void 0;var n=e("../misc/queue"),r=function(){function e(){}return e.prototype.interact=function(e,t){var o=new Array;o.push(e);var r=new n.Queue;for(r.enqueue(e.id);r.count()>0;)for(var i=r.count(),c=0;c<i;c++){var s=t.getGridBlockById(r.dequeue());this.checkAndAddSimilar(t.getGridBlock(s.row,s.col-1),s,o,r),this.checkAndAddSimilar(t.getGridBlock(s.row+1,s.col),s,o,r),this.checkAndAddSimilar(t.getGridBlock(s.row,s.col+1),s,o,r),this.checkAndAddSimilar(t.getGridBlock(s.row-1,s.col),s,o,r)}return o},e.prototype.checkAndAddSimilar=function(e,t,o,n){(null==e?void 0:e.block)===(null==t?void 0:t.block)&&(o.find(function(t){return t.id==e.id})||(o.push(e),n.enqueue(e.id)))},e}();o.NormalBlock=r,cc._RF.pop()},{"../misc/queue":"queue"}],PersistData:[function(e,t,o){"use strict";cc._RF.push(t,"392c2VarlBJfK2z1NVb606N","PersistData");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,u=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.simpleSprite=null,t.sceneTransistor=null,t}return r(t,e),t.prototype.onLoad=function(){cc.game.addPersistRootNode(this.node)},i([u(cc.Prefab)],t.prototype,"simpleSprite",void 0),i([u(cc.Prefab)],t.prototype,"sceneTransistor",void 0),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],RocketHBlock:[function(e,t,o){"use strict";cc._RF.push(t,"88582z8qWNGU6HsoRcT7TWJ","RocketHBlock"),Object.defineProperty(o,"__esModule",{value:!0}),o.RocketHBlock=void 0;var n=e("../enums/gameEvent"),r=function(){function e(){}return e.prototype.interact=function(e,t,o){for(var r=new Array,i=0;i<t.getGridBlocksCols();i++)r.push(t.getGridBlock(e.row,i));return null==o||o.emit(n.GAMEEVENT.ROCKETH_ANIMATION,e),r.filter(function(e){return null!=e})},e}();o.RocketHBlock=r,cc._RF.pop()},{"../enums/gameEvent":"gameEvent"}],RocketVBlock:[function(e,t,o){"use strict";cc._RF.push(t,"db268bwaJZA3aaRiucW14wH","RocketVBlock"),Object.defineProperty(o,"__esModule",{value:!0}),o.RocketVBlock=void 0;var n=e("../enums/gameEvent"),r=function(){function e(){}return e.prototype.interact=function(e,t,o){for(var r=new Array,i=0;i<t.getGridBlocksRows();i++)r.push(t.getGridBlock(i,e.col));return null==o||o.emit(n.GAMEEVENT.ROCKETV_ANIMATION,e),r.filter(function(e){return null!=e})},e}();o.RocketVBlock=r,cc._RF.pop()},{"../enums/gameEvent":"gameEvent"}],SuperBombBlock:[function(e,t,o){"use strict";cc._RF.push(t,"63992bKHVJGLLLv/8TWGWq0","SuperBombBlock"),Object.defineProperty(o,"__esModule",{value:!0}),o.SuperBombBlock=void 0;var n=e("../enums/gameEvent"),r=function(){function e(){}return e.prototype.interact=function(e,t,o){var r=new Array;return r.push(t.getGridBlock(e.row,e.col)),r.push(t.getGridBlock(e.row,e.col-1)),r.push(t.getGridBlock(e.row+1,e.col-1)),r.push(t.getGridBlock(e.row+1,e.col)),r.push(t.getGridBlock(e.row+1,e.col+1)),r.push(t.getGridBlock(e.row,e.col+1)),r.push(t.getGridBlock(e.row-1,e.col+1)),r.push(t.getGridBlock(e.row-1,e.col)),r.push(t.getGridBlock(e.row-1,e.col-1)),r.push(t.getGridBlock(e.row,e.col-2)),r.push(t.getGridBlock(e.row+2,e.col)),r.push(t.getGridBlock(e.row,e.col+2)),r.push(t.getGridBlock(e.row-2,e.col)),null==o||o.emit(n.GAMEEVENT.BOMB_ANIMATION,e),r.filter(function(e){return null!=e})},e}();o.SuperBombBlock=r,cc._RF.pop()},{"../enums/gameEvent":"gameEvent"}],blockGenerator:[function(e,t,o){"use strict";cc._RF.push(t,"0f090DW7fNL+ZJevnPNe/jl","blockGenerator"),Object.defineProperty(o,"__esModule",{value:!0}),o.BlockFactory=void 0;var n,r=e("../enums/block"),i=e("../enums/blockType"),c=e("../helpers/mathHelper"),s=function(){function e(e){this._blocksAll=Object.values(r.BLOCK).filter(function(e){return isNaN(Number(e))}),this._blocksNoBonuses=Object.keys(r.BLOCK).filter(function(e){return isNaN(Number(e))&&e.startsWith("block")}),this._blocksBonuses=Object.keys(r.BLOCK).filter(function(e){return isNaN(Number(e))&&!e.startsWith("block")}),(n=this).settings=e}return e.prototype.newBlock=function(){return 1===c.MathHelper.getRandomInt(0,n.settings.getBonusChance())?n.bonusBlock():n.normalBlock()},e.prototype.bonusBlock=function(){return{id:c.MathHelper.newUUID(),block:this.getRandomBonusBlock(),blockType:i.BLOCKTYPE.bonus}},e.prototype.normalBlock=function(){return{id:c.MathHelper.newUUID(),block:this.getRandomNormalBlock(),blockType:i.BLOCKTYPE.normal}},e.prototype.getRandomBonusBlock=function(){return r.BLOCK[n._blocksBonuses[c.MathHelper.getRandomInt(0,this._blocksBonuses.length-1)]]},e.prototype.getRandomNormalBlock=function(){return r.BLOCK[n._blocksNoBonuses[c.MathHelper.getRandomInt(0,this._blocksNoBonuses.length-1)]]},e}();o.BlockFactory=s,cc._RF.pop()},{"../enums/block":"block","../enums/blockType":"blockType","../helpers/mathHelper":"mathHelper"}],blockInteractor:[function(e,t,o){"use strict";cc._RF.push(t,"881d1Ii1gxDfLhEWwQeAHDt","blockInteractor"),Object.defineProperty(o,"__esModule",{value:!0}),o.BlockInteractor=void 0;var n=e("../blocks/BombBlock"),r=e("../blocks/NormalBlock"),i=e("../blocks/RocketHBlock"),c=e("../blocks/RocketVBlock"),s=e("../blocks/SuperBombBlock"),u=e("../enums/block"),l=e("../enums/booster"),a=function(){function e(){this._interactions=new Map,this._boosterInteractions=new Map;var e=new r.NormalBlock;this._interactions.set(u.BLOCK.block1,e),this._interactions.set(u.BLOCK.block2,e),this._interactions.set(u.BLOCK.block3,e),this._interactions.set(u.BLOCK.block4,e),this._interactions.set(u.BLOCK.bomb,new n.BombBlock),this._interactions.set(u.BLOCK.rocketh,new i.RocketHBlock),this._interactions.set(u.BLOCK.rocketv,new c.RocketVBlock),this._boosterInteractions.set(l.BOOSTER.superbomb,new s.SuperBombBlock)}return e.prototype.getBlockInteraction=function(e){return this._interactions.get(e)},e.prototype.getBoosterInteraction=function(e){return this._boosterInteractions.get(e)},e}();o.BlockInteractor=a,cc._RF.pop()},{"../blocks/BombBlock":"BombBlock","../blocks/NormalBlock":"NormalBlock","../blocks/RocketHBlock":"RocketHBlock","../blocks/RocketVBlock":"RocketVBlock","../blocks/SuperBombBlock":"SuperBombBlock","../enums/block":"block","../enums/booster":"booster"}],blockType:[function(e,t,o){"use strict";cc._RF.push(t,"ac923OnHkZMQpZtrxzoYf8N","blockType"),Object.defineProperty(o,"__esModule",{value:!0}),o.BLOCKTYPE=void 0,function(e){e[e.normal=0]="normal",e[e.bonus=1]="bonus"}(o.BLOCKTYPE||(o.BLOCKTYPE={})),cc._RF.pop()},{}],block:[function(e,t,o){"use strict";cc._RF.push(t,"8c353OvSZ5IloV6PVh3Wx46","block"),Object.defineProperty(o,"__esModule",{value:!0}),o.BLOCK=void 0,function(e){e[e.block1=0]="block1",e[e.block2=1]="block2",e[e.block3=2]="block3",e[e.block4=3]="block4",e[e.bomb=4]="bomb",e[e.rocketh=5]="rocketh",e[e.rocketv=6]="rocketv"}(o.BLOCK||(o.BLOCK={})),cc._RF.pop()},{}],booster:[function(e,t,o){"use strict";cc._RF.push(t,"85bb7NOoUZCoq0mjKI4KeXj","booster"),Object.defineProperty(o,"__esModule",{value:!0}),o.BOOSTER=void 0,function(e){e[e.superbomb=0]="superbomb",e[e.reshuffle=1]="reshuffle"}(o.BOOSTER||(o.BOOSTER={})),cc._RF.pop()},{}],container:[function(e,t,o){"use strict";cc._RF.push(t,"f36ccOYY2JODI9uMPGgp9Iv","container"),Object.defineProperty(o,"__esModule",{value:!0}),o.DI=o.Container=void 0;var n=function(){function e(){this.services=new Map}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.addSingleton=function(e,t){this.services.set(e,{initial:t,scope:"Singleton"})},e.prototype.addTransient=function(e,t){this.services.set(e,{initial:t,scope:"Transient"})},e.prototype.resolve=function(e){var t=this.services.get(e);if(!t)throw new Error("Service not found: "+e);return"Singleton"==t.scope?(t.instance||(t.instance=t.initial()),t.instance):t.initial()},e.prototype.clear=function(){this.services.clear()},e}();o.Container=n,o.DI=n.getInstance(),cc._RF.pop()},{}],eventEmitter:[function(e,t,o){"use strict";cc._RF.push(t,"a6868q/9fRDj7YFxVOkHyx0","eventEmitter"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventEmitter=void 0;var n=function(){function e(){this.events=new Map}return e.prototype.emit=function(e,t){var o;null===(o=this.events.get(e))||void 0===o||o.forEach(function(e){return e(t)})},e.prototype.on=function(e,t){var o=this;return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t),function(){return o.off(e,t)}},e.prototype.off=function(e,t){var o;null===(o=this.events.get(e))||void 0===o||o.delete(t)},e.prototype.removeAll=function(e){void 0!==e?this.events.delete(e):this.events.clear()},e}();o.EventEmitter=n,cc._RF.pop()},{}],gameEvent:[function(e,t,o){"use strict";cc._RF.push(t,"087c97wvIJPbqPRtjqc9qjQ","gameEvent"),Object.defineProperty(o,"__esModule",{value:!0}),o.GAMEEVENT=void 0,function(e){e[e.POINTS_CHANGED=0]="POINTS_CHANGED",e[e.MOVES_CHANGED=1]="MOVES_CHANGED",e[e.NEW_LEVEL=2]="NEW_LEVEL",e[e.PREPARE_GRID=3]="PREPARE_GRID",e[e.GRID_PREPARED=4]="GRID_PREPARED",e[e.BOOSTER_BOMB_STATE_CHANGED=5]="BOOSTER_BOMB_STATE_CHANGED",e[e.BOOSTER_BOMB_QANTITY_CHANGED=6]="BOOSTER_BOMB_QANTITY_CHANGED",e[e.BOOSTER_RESHUFFLE_QANTITY_CHANGED=7]="BOOSTER_RESHUFFLE_QANTITY_CHANGED",e[e.RESHUFFLE=8]="RESHUFFLE",e[e.BLOCK_CREATED=9]="BLOCK_CREATED",e[e.WIN=10]="WIN",e[e.LOSE=11]="LOSE",e[e.BLOCK_CLICK_HAPPENED=12]="BLOCK_CLICK_HAPPENED",e[e.BOMB_ANIMATION=13]="BOMB_ANIMATION",e[e.ROCKETV_ANIMATION=14]="ROCKETV_ANIMATION",e[e.ROCKETH_ANIMATION=15]="ROCKETH_ANIMATION"}(o.GAMEEVENT||(o.GAMEEVENT={})),cc._RF.pop()},{}],gameSettings:[function(e,t,o){"use strict";cc._RF.push(t,"b057edmHNFAOaZc1mqe0dC8","gameSettings"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameSettings=void 0;var n=e("../helpers/mathHelper"),r=function(){function e(){this._rows=9,this._cols=9,this._colWidth=100,this._rowHeight=105,this._possibleStartBonuses=100,this._bonusChance=10,this._startedMoves=10,this._targetPoints=100,this._startedBoosterReshuffle=2,this._startedBoosterBomb=2}return e.prototype.getRows=function(){return this._rows},e.prototype.setRows=function(e){this._rows=n.MathHelper.clamp(e,1,9)},e.prototype.getCols=function(){return this._cols},e.prototype.setCols=function(e){this._cols=n.MathHelper.clamp(e,1,9)},e.prototype.getColWidth=function(){return this._colWidth},e.prototype.getRowHeight=function(){return this._rowHeight},e.prototype.getPossibleStartBonuses=function(){return this._possibleStartBonuses},e.prototype.getBonusChance=function(){return this._bonusChance},e.prototype.setStartedMoves=function(e){this._startedMoves=e},e.prototype.getStartedMoves=function(){return this._startedMoves},e.prototype.setTargetPoints=function(e){this._targetPoints=e},e.prototype.getTargetPoints=function(){return this._targetPoints},e.prototype.setStartedBoosterReshuffle=function(e){this._startedBoosterReshuffle=e},e.prototype.getStartedBoosterReshuffle=function(){return this._startedBoosterReshuffle},e.prototype.setStartedBoosterBomb=function(e){this._startedBoosterBomb=e},e.prototype.getStartedBoosterBomb=function(){return this._startedBoosterBomb},e}();o.GameSettings=r,cc._RF.pop()},{"../helpers/mathHelper":"mathHelper"}],gameState:[function(e,t,o){"use strict";cc._RF.push(t,"c854072gj5G8Ir7GeHF6PPD","gameState"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameState=void 0;var n=e("../enums/booster"),r=e("../enums/gameEvent"),i=function(){function e(e,t){this._activeBooster=null,this.settings=e,this.events=t}return e.prototype.initGridBlocks=function(e,t){this._gridBlocks=Array(e).fill(null).map(function(){return Array(t).fill(null)})},e.prototype.setGridBlock=function(e,t,o){return this._gridBlocks[e][t]=o,o},e.prototype.getGridBlock=function(e,t){return e<0||t<0||e>=this.settings.getRows()||t>=this.settings.getCols()?null:this._gridBlocks[e][t]},e.prototype.getGridBlockById=function(e){for(var t,o=0;o<this.settings.getRows();o++)for(var n=0;n<this.settings.getCols();n++)if((null===(t=this._gridBlocks[o][n])||void 0===t?void 0:t.id)===e)return this._gridBlocks[o][n];return null},e.prototype.setMoves=function(e){this._moves=e<0?0:e,this.events.emit(r.GAMEEVENT.MOVES_CHANGED,this.getMoves())},e.prototype.minusMove=function(){this.setMoves(this.getMoves()-1)},e.prototype.getMoves=function(){return this._moves},e.prototype.setCollectedPoints=function(e){this._collectedPoints=e,this.events.emit(r.GAMEEVENT.POINTS_CHANGED,{points:this.getCollectedPoints()+"/"+this.settings.getTargetPoints(),progress:this.getCollectedPoints()/this.settings.getTargetPoints()})},e.prototype.addCollectedPoins=function(e){null!=e?this.setCollectedPoints(this._collectedPoints+e):this.setCollectedPoints(this._collectedPoints+1)},e.prototype.getCollectedPoints=function(){return this._collectedPoints},e.prototype.setReshuffleTries=function(e){this._reshuffleTries=e<0?0:e},e.prototype.getReshuffleTries=function(){return this._reshuffleTries},e.prototype.setBoosterReshuffle=function(e){this._boosterReshuffle=e<0?0:e,this.events.emit(r.GAMEEVENT.BOOSTER_RESHUFFLE_QANTITY_CHANGED,this.getBoosterReshuffle())},e.prototype.getBoosterReshuffle=function(){return this._boosterReshuffle},e.prototype.minusBoosterReshuffle=function(){this.setBoosterReshuffle(this.getBoosterReshuffle()-1)},e.prototype.setBoosterBomb=function(e){this._boosterBomb=e<0?0:e,this.events.emit(r.GAMEEVENT.BOOSTER_BOMB_QANTITY_CHANGED,this.getBoosterBomb())},e.prototype.getBoosterBomb=function(){return this._boosterBomb},e.prototype.minusBoosterBomb=function(){this.setBoosterBomb(this.getBoosterBomb()-1)},e.prototype.toggleActiveBooster=function(e){var t=this._activeBooster,o=t==e?null:e;if(t==n.BOOSTER.superbomb||e==n.BOOSTER.superbomb){if(this.getBoosterBomb()<=0)return;this.events.emit(r.GAMEEVENT.BOOSTER_BOMB_STATE_CHANGED,o==n.BOOSTER.superbomb)}this._activeBooster=o},e.prototype.getActiveBooster=function(){return this._activeBooster},e.prototype.getGridBlocksCols=function(){return this._gridBlocks.length},e.prototype.getGridBlocksRows=function(){return this._gridBlocks[0].length},e}();o.GameState=i,cc._RF.pop()},{"../enums/booster":"booster","../enums/gameEvent":"gameEvent"}],gridPointsService:[function(e,t,o){"use strict";cc._RF.push(t,"9c07717uwBHcKNoRbH4Ew7c","gridPointsService"),Object.defineProperty(o,"__esModule",{value:!0}),o.GridViewService=void 0;var n=function(){function e(e){this.settings=e}return e.prototype.initGridPoints=function(){var e=this.settings.getRows(),t=this.settings.getCols();this._gridPoints=Array(e).fill(null).map(function(){return Array(t).fill(null)});for(var o=0;o<e;o++)for(var n=0;n<t;n++)this.setGridPoint(o,n,{x:this.settings.getColWidth()/2-t*(this.settings.getColWidth()/2)+n*this.settings.getColWidth(),y:this.settings.getRowHeight()/2-e*(this.settings.getRowHeight()/2)+o*this.settings.getRowHeight()})},e.prototype.setGridPoint=function(e,t,o){this._gridPoints[e][t]=o},e.prototype.getGridPoint=function(e,t){return this._gridPoints[e][t]},e}();o.GridViewService=n,cc._RF.pop()},{}],iBlockData:[function(e,t,o){"use strict";cc._RF.push(t,"52217FnEqZEyIBiZgttM/3i","iBlockData"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iBlockGenerator:[function(e,t,o){"use strict";cc._RF.push(t,"0c840SGXS5HWYSjgKtrVUAI","iBlockGenerator"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iBlockInteractor:[function(e,t,o){"use strict";cc._RF.push(t,"aa568iTz9hBe7WFyA0R26OT","iBlockInteractor"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iEventEmitter:[function(e,t,o){"use strict";cc._RF.push(t,"d5a1eaNs0FDkoydnJCXTHXO","iEventEmitter"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iGameSettings:[function(e,t,o){"use strict";cc._RF.push(t,"76805RDValK5rj0O1HVDj+k","iGameSettings"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iGameState:[function(e,t,o){"use strict";cc._RF.push(t,"7048f3LXrJDEJH9d4JogQxb","iGameState"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iGridElement:[function(e,t,o){"use strict";cc._RF.push(t,"f42dfo2cGlF/5P8iss79ek/","iGridElement"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iGridPointsService:[function(e,t,o){"use strict";cc._RF.push(t,"6e2c7SZIJ1CErX04DRp7zfp","iGridPointsService"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iInteractResponse:[function(e,t,o){"use strict";cc._RF.push(t,"10c7cb1d3lKe5/Yqt8gAClm","iInteractResponse"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iInteractedBlock:[function(e,t,o){"use strict";cc._RF.push(t,"9a3f3hXn7ZKoJ2S1xQCiPy8","iInteractedBlock"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iLogicService:[function(e,t,o){"use strict";cc._RF.push(t,"59a76BjjCNJjbORx/uFg5RP","iLogicService"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iMove:[function(e,t,o){"use strict";cc._RF.push(t,"faf3eRPVzBAppN9R6lDwYVQ","iMove"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iNode:[function(e,t,o){"use strict";cc._RF.push(t,"5506fldhiZGz7rDsuWDb0MA","iNode");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.INode=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(cc.Node);o.INode=i,cc._RF.pop()},{}],iPoint:[function(e,t,o){"use strict";cc._RF.push(t,"02b44Hdne9OvqY5yKFvH0JV","iPoint"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iQueue:[function(e,t,o){"use strict";cc._RF.push(t,"5c52aVqQ9VPq49yLu0BznKo","iQueue"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iTestService:[function(e,t,o){"use strict";cc._RF.push(t,"aea03tXJjBEo5mhS7utXGns","iTestService"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],iUiUtils:[function(e,t,o){"use strict";cc._RF.push(t,"cd608fpUeBJtLS8yXTsKIty","iUiUtils"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],init:[function(e,t,o){"use strict";cc._RF.push(t,"4e86dADxttLwrDIZIc9/UF+","init"),Object.defineProperty(o,"__esModule",{value:!0}),o.getGridPoints=o.getEvents=o.getBlockInteractor=o.getBlockGenerator=o.getState=o.getSettings=o.getUI=o.getLogic=o.DIInitializer=void 0;var n=e("../enums/service"),r=e("../services/gameState"),i=e("../services/gameSettings"),c=e("../services/logicService"),s=e("./container"),u=e("../services/uiUtilsService"),l=e("../services/blockGenerator"),a=e("../services/blockInteractor"),p=e("../services/eventEmitter"),f=e("../services/gridPointsService"),d=function(){function e(){}return e.initialize=function(){s.DI.initialized||(s.DI.addSingleton(n.SERVICE.LogicService,function(){return new c.LogicService(h(),v(),g(),b(),_(),m())}),s.DI.addSingleton(n.SERVICE.GameSettings,function(){return new i.GameSettings}),s.DI.addSingleton(n.SERVICE.GameState,function(){return new r.GameState(h(),_())}),s.DI.addSingleton(n.SERVICE.UI,function(){return new u.UiUtils}),s.DI.addSingleton(n.SERVICE.BlockGenerator,function(){return new l.BlockFactory(h())}),s.DI.addSingleton(n.SERVICE.BlockInteractor,function(){return new a.BlockInteractor}),s.DI.addSingleton(n.SERVICE.Events,function(){return new p.EventEmitter}),s.DI.addSingleton(n.SERVICE.GridView,function(){return new f.GridViewService(h())})),s.DI.initialized=!0},e}();function h(){return s.DI.resolve(n.SERVICE.GameSettings)}function v(){return s.DI.resolve(n.SERVICE.GameState)}function g(){return s.DI.resolve(n.SERVICE.BlockGenerator)}function b(){return s.DI.resolve(n.SERVICE.BlockInteractor)}function _(){return s.DI.resolve(n.SERVICE.Events)}function m(){return s.DI.resolve(n.SERVICE.GridView)}o.DIInitializer=d,o.getLogic=function(){return s.DI.resolve(n.SERVICE.LogicService)},o.getUI=function(){return s.DI.resolve(n.SERVICE.UI)},o.getSettings=h,o.getState=v,o.getBlockGenerator=g,o.getBlockInteractor=b,o.getEvents=_,o.getGridPoints=m,cc._RF.pop()},{"../enums/service":"service","../services/blockGenerator":"blockGenerator","../services/blockInteractor":"blockInteractor","../services/eventEmitter":"eventEmitter","../services/gameSettings":"gameSettings","../services/gameState":"gameState","../services/gridPointsService":"gridPointsService","../services/logicService":"logicService","../services/uiUtilsService":"uiUtilsService","./container":"container"}],logicService:[function(e,t,o){"use strict";cc._RF.push(t,"a2fd0ahmZNPvYuzeGi6oJ3W","logicService");var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{u(n.next(e))}catch(t){i(t)}}function s(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.LogicService=void 0;var c,s=e("../enums/blockType"),u=e("../enums/booster"),l=e("../enums/gameEvent"),a=e("../helpers/mathHelper"),p=e("../misc/queue"),f=function(){function e(e,t,o,n,r,i){(c=this).settings=e,c.state=t,c.blockGenerator=o,c.blockInteractor=n,c.events=r,c.gridPoints=i}return e.prototype.newLevel=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return c.clearState(),e=new Promise(function(e){var t=c.events.on(l.GAMEEVENT.GRID_PREPARED,function(){t(),e()})}),c.events.emit(l.GAMEEVENT.PREPARE_GRID),[4,e];case 1:return t.sent(),c.fillGrid(),[2]}})})},e.prototype.clearState=function(){c.state.toggleActiveBooster(null),c.state.setCollectedPoints(0),c.state.setMoves(c.settings.getStartedMoves()),c.state.setBoosterBomb(c.settings.getStartedBoosterBomb()),c.state.setBoosterReshuffle(c.settings.getStartedBoosterReshuffle()),c.gridPoints.initGridPoints()},e.prototype.fillGrid=function(){var e=c.settings.getRows(),t=c.settings.getCols();c.state.initGridBlocks(e,t);for(var o=0;o<e;o++)for(var r=0;r<t;r++){var i=c.state.setGridBlock(o,r,n(n({},c.blockGenerator.newBlock()),{row:o,col:r}));c.events.emit(l.GAMEEVENT.BLOCK_CREATED,i)}},e.prototype.handleBoosterClick=function(e){switch(e){case u.BOOSTER.reshuffle:if(c.state.getBoosterReshuffle()>0){var t=c.reshuffle();c.state.minusBoosterReshuffle(),c.events.emit(l.GAMEEVENT.RESHUFFLE,t)}break;case u.BOOSTER.superbomb:c.state.toggleActiveBooster(u.BOOSTER.superbomb);break;default:return}},e.prototype.addCollectedPoints=function(){c.state.addCollectedPoins()},e.prototype.checkWinLose=function(){c.state.getCollectedPoints()>c.settings.getTargetPoints()?c.events.emit(l.GAMEEVENT.WIN):0==c.state.getMoves()&&c.events.emit(l.GAMEEVENT.LOSE)},e.prototype.reshuffle=function(){for(var e=[],t=[],o=c.settings.getRows(),n=c.settings.getCols(),r=0;r<o;r++)for(var i=0;i<c.settings.getCols();i++)t.push(c.state.getGridBlock(r,i));a.MathHelper.shuffleArrayInPlace(t);var s=0;for(r=0;r<o;r++)for(i=0;i<n;i++)t[s].col==i&&t[s].row==r||e.push({id:t[s].id,row:r,col:i}),t[s].col=i,t[s].row=r,c.state.setGridBlock(r,i,t[s]),s++;return e},e.prototype.handleBlockClick=function(e){var t={interactedBlockId:e,normalBlocks:new Set,bonusBlocks:new Set,moveSuccess:!1},o=c.state.getGridBlockById(e);if(o){t.chain=new p.Queue;var n=!0,r=c.state.getActiveBooster();if(null!==r){var i=c.blockInteractor.getBoosterInteraction(r).interact(o,c.state,c.events);c.processAffectedBlocks(i,t),r==u.BOOSTER.superbomb&&(c.state.toggleActiveBooster(null),c.state.minusBoosterBomb())}else t.chain.enqueue(e);for(;t.chain.count()>0;){var a=t.chain.dequeue(),f=n?o:c.state.getGridBlockById(a);c.processOne(f,t),f&&(i=c.blockInteractor.getBlockInteraction(f.block).interact(f,c.state,c.events),c.processAffectedBlocks(i,t),f.blockType==s.BLOCKTYPE.bonus&&c.state.setGridBlock(f.row,f.col,null)),n=!1}t.moveSuccess=t.normalBlocks.size>1||t.bonusBlocks.size>=1,t.moveSuccess&&(c.processResponse(t),c.state.minusMove()),c.events.emit(l.GAMEEVENT.BLOCK_CLICK_HAPPENED,t)}},e.prototype.processOne=function(e,t){(null==e?void 0:e.blockType)==s.BLOCKTYPE.bonus?t.bonusBlocks.add(e.id):(null==e?void 0:e.blockType)==s.BLOCKTYPE.normal&&t.normalBlocks.add(e.id)},e.prototype.processAffectedBlocks=function(e,t){e.forEach(function(e){c.processAffectedBlock(e,t)})},e.prototype.processAffectedBlock=function(e,t){e.blockType==s.BLOCKTYPE.bonus?t.bonusBlocks.has(e.id)||t.chain.enqueue(e.id):t.normalBlocks.add(e.id)},e.prototype.processResponse=function(e){e.moveSuccess&&(c.destroyBlocks(e),c.moveAndNewBlocks(e))},e.prototype.moveAndNewBlocks=function(){for(var e=c.settings.getCols(),t=c.settings.getRows(),o=[],r=0;r<e;r++){for(var i=[],s=0;s<t;s++)c.state.getGridBlock(s,r)&&i.push(c.state.getGridBlock(s,r));for(s=0;s<t;s++){var u=1;if(i[s]){var a=n(n({},i[s]),{row:s});c.state.setGridBlock(s,r,a),o.push({id:a.id,row:s,col:r})}else a=n(n({},c.blockGenerator.newBlock()),{row:s,col:r,above:u}),c.state.setGridBlock(s,r,a),c.events.emit(l.GAMEEVENT.BLOCK_CREATED,a),u++}}o.length>0&&c.events.emit(l.GAMEEVENT.RESHUFFLE,o)},e.prototype.destroyBlocks=function(e){for(var t,o=0;o<c.settings.getRows();o++)for(var n=0;n<c.settings.getCols();n++)e.normalBlocks.has(null===(t=c.state.getGridBlock(o,n))||void 0===t?void 0:t.id)&&c.state.setGridBlock(o,n,null)},e.prototype.translate=function(e){cc.log("----"+e);for(var t=0;t<c.settings.getRows();t++)c.state.getGridBlock(t,0)?cc.log(c.state.getGridBlock(t,0).row+" "+c.state.getGridBlock(t,0).col+" "+c.state.getGridBlock(t,0).id+" "+c.state.getGridBlock(t,0).above):cc.log(t+" 0 null");cc.log("----")},e}();o.LogicService=f,cc._RF.pop()},{"../enums/blockType":"blockType","../enums/booster":"booster","../enums/gameEvent":"gameEvent","../helpers/mathHelper":"mathHelper","../misc/queue":"queue"}],logoScene:[function(e,t,o){"use strict";cc._RF.push(t,"08bb8G036VKZ5NUQsW8gxlx","logoScene");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c,s=e("../../ioc/init"),u=cc._decorator,l=u.ccclass,a=(u.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){s.DIInitializer.initialize(),(c=this).ui=s.getUI()},t.prototype.start=function(){c.scheduleOnce(function(){c.ui.nextScene("Main")},2)},i([l],t)}(cc.Component));o.default=a,cc._RF.pop()},{"../../ioc/init":"init"}],mainScene:[function(e,t,o){"use strict";cc._RF.push(t,"a0f8fusb/JHJrzlkKHnCUlG","mainScene");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},c=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{u(n.next(e))}catch(t){i(t)}}function s(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}u((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var u,l=e("../../enums/block"),a=e("../../enums/booster"),p=e("../../enums/gameEvent"),f=e("../../enums/zIndexes"),d=e("../../helpers/mathHelper"),h=e("../../ioc/init"),v=cc._decorator,g=v.ccclass,b=v.property,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blocksOnStage=new Map,t.block=null,t.bigBoom=null,t.lighting=null,t.block1=null,t.block2=null,t.block3=null,t.block4=null,t.bomb=null,t.rocketh=null,t.rocketv=null,t}return r(t,e),t.prototype.onLoad=function(){h.DIInitializer.initialize(),(u=this).logic=h.getLogic(),u.ui=h.getUI(),u.settings=h.getSettings(),u.events=h.getEvents(),u.grid=h.getGridPoints(),u.blocksPool=new cc.NodePool("Block"),u.gridCoverNode=cc.find("Canvas/gameplay_node/parent"),u.movesLabel=cc.find("Canvas/moves_node/moves"),u.movesLabel.parent.zIndex=f.ZINDEX.movesNode,u.movesBackground=cc.find("Canvas/moves_node/bg_moves"),u.pointsLabel=cc.find("Canvas/moves_node/points"),u.boosterReshuffle=cc.find("Canvas/boosters_node/boosters_panel/reshuffle_booster/icon"),u.boosterReshuffleLabel=cc.find("Canvas/boosters_node/boosters_panel/reshuffle_booster/label"),u.boosterBomb=cc.find("Canvas/boosters_node/boosters_panel/bomb_booster/icon"),u.boosterBombLabel=cc.find("Canvas/boosters_node/boosters_panel/bomb_booster/label"),u.canvas=cc.find("Canvas"),u.progress=cc.find("Canvas/moves_node/progress"),u.settingsNode=cc.find("Canvas/settings"),u.shadow=cc.find("Canvas/shadow"),u.replay=cc.find("Canvas/gameplay_node/replay"),u.winLoseLabel=cc.find("Canvas/gameplay_node/winlose")},t.prototype.start=function(){return c(this,void 0,void 0,function(){var e=this;return s(this,function(){return u.boosterReshuffle.on(cc.Node.EventType.TOUCH_START,function(){u.ui.uiIsLocked()||u.logic.handleBoosterClick(a.BOOSTER.reshuffle)}),u.boosterBomb.on(cc.Node.EventType.TOUCH_START,function(){u.ui.uiIsLocked()||u.logic.handleBoosterClick(a.BOOSTER.superbomb)}),u.replay.on(cc.Node.EventType.TOUCH_START,function(){u.ui.uiIsLocked()||u.logic.newLevel()}),u.settingsNode.on(cc.Node.EventType.TOUCH_START,function(){u.ui.uiIsLocked()||u.scheduleOnce(function(){u.ui.nextScene("Settings")},.1)}),u.ui.hoverButton(u.settingsNode),u.ui.hoverButton(u.boosterReshuffle),u.ui.hoverButton(u.boosterBomb),u.ui.hoverButton(u.replay),u.events.on(p.GAMEEVENT.MOVES_CHANGED,function(e){return u.updateMoves(e)}),u.events.on(p.GAMEEVENT.POINTS_CHANGED,function(e){return u.updatePoints(e)}),u.events.on(p.GAMEEVENT.PREPARE_GRID,function(){return c(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,u.startNewLevel()];case 1:return[2,e.sent()]}})})}),u.events.on(p.GAMEEVENT.BOOSTER_RESHUFFLE_QANTITY_CHANGED,function(e){return u.updateReshuffleCount(e)}),u.events.on(p.GAMEEVENT.BOOSTER_BOMB_QANTITY_CHANGED,function(e){return u.updateBombCount(e)}),u.events.on(p.GAMEEVENT.BOOSTER_BOMB_STATE_CHANGED,function(e){return u.updateBombState(e)}),u.events.on(p.GAMEEVENT.RESHUFFLE,function(t){return c(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,u.reshuffle(t)];case 1:return[2,e.sent()]}})})}),u.events.on(p.GAMEEVENT.WIN,function(){return c(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,u.winLose()];case 1:return[2,e.sent()]}})})}),u.events.on(p.GAMEEVENT.LOSE,function(){return c(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,u.winLose(!1)];case 1:return[2,e.sent()]}})})}),u.events.on(p.GAMEEVENT.BLOCK_CREATED,function(t){return c(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,u.createBlock(t)];case 1:return[2,e.sent()]}})})}),u.events.on(p.GAMEEVENT.BLOCK_CLICK_HAPPENED,function(t){return c(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,u.interaction(t)];case 1:return[2,e.sent()]}})})}),u.events.on(p.GAMEEVENT.BOMB_ANIMATION,function(e){return u.boomClip(e)}),u.events.on(p.GAMEEVENT.ROCKETH_ANIMATION,function(e){return u.lightingClip(e)}),u.events.on(p.GAMEEVENT.ROCKETV_ANIMATION,function(e){return u.lightingClip(e,!0)}),u.logic.newLevel(),[2]})})},t.prototype.startNewLevel=function(){return c(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return e.trys.push([0,,2,3]),u.ui.addLock(),u.ui.shadow(u.shadow,!1),[4,u.adaptGridCover()];case 1:return e.sent(),u.replay.position=cc.v3(0,-1300),u.winLoseLabel.position=cc.v3(0,1300),[3,3];case 2:return u.ui.removeLock(),u.events.emit(p.GAMEEVENT.GRID_PREPARED),[7];case 3:return[2]}})})},t.prototype.adaptGridCover=function(e,t){return c(this,void 0,Promise,function(){var o,n;return s(this,function(){return null!=e||(e=u.settings.getRows()),null!=t||(t=u.settings.getCols()),o=t*u.settings.getColWidth()+.75*u.settings.getColWidth(),n=e*u.settings.getRowHeight()+.75*u.settings.getRowHeight(),[2,new Promise(function(e){cc.tween(u.gridCoverNode.parent).to(.2,{width:o,height:n},{easing:"backIn"}).start(),cc.tween(u.gridCoverNode).to(.2,{width:o,height:n},{easing:"backIn"}).call(function(){e()}).start()})]})})},t.prototype.reshuffle=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(){try{u.ui.addLock(),t=[],e.forEach(function(e){var o=u.blocksOnStage.get(e.id);if(o){var n=u.grid.getGridPoint(e.row,e.col);t.push(u.ui.toPositionXY(o,n.x,n.y,.5))}}),Promise.all(t)}finally{u.ui.removeLock()}return[2]})})},t.prototype.interaction=function(e){var t;return c(this,void 0,void 0,function(){var o;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,,4,5]),u.ui.addLock(),e.moveSuccess?(null===(t=e.bonusBlocks)||void 0===t||t.forEach(function(e){var t=u.blocksOnStage.get(e);u.destroyBlock(t)}),o=[],e.normalBlocks.forEach(function(e){var t=u.blocksOnStage.get(e);o.push(u.destroyBlockToPoints(t))}),[4,Promise.all(o)]):[3,2];case 1:return n.sent(),u.logic.checkWinLose(),[3,3];case 2:u.ui.pulse(u.blocksOnStage.get(e.interactedBlockId)),n.label=3;case 3:return[3,5];case 4:return u.ui.removeLock(),[7];case 5:return[2]}})})},t.prototype.createBlock=function(e){var t;return c(this,void 0,Promise,function(){var o,n,r=this;return s(this,function(i){switch(i.label){case 0:return i.trys.push([0,,4,5]),u.ui.addLock(),(o=null!==(t=u.blocksPool.get())&&void 0!==t?t:u.ui.createNode(u.block)).scale=1,o.angle=0,o.getComponent(cc.Sprite).spriteFrame=u[l.BLOCK[e.block]],o.gId=e.id,o.gTag=l.BLOCK[e.block],o.setParent(u.gridCoverNode),o.zIndex=f.ZINDEX.blocks,o.on(cc.Node.EventType.TOUCH_START,function(){return c(r,void 0,void 0,function(){return s(this,function(){return u.ui.uiIsLocked()||u.logic.handleBlockClick(o.gId),[2]})})}),u.blocksOnStage.set(o.gId,o),n=u.grid.getGridPoint(e.row,e.col),e.above?(o.setPosition(n.x,n.y+2*u.settings.getRowHeight()+u.settings.getRowHeight()*e.above),[4,u.ui.toPositionXY(o,n.x,n.y,.5)]):[3,2];case 1:return i.sent(),[3,3];case 2:o.setPosition(n.x,n.y),i.label=3;case 3:return[2,o];case 4:return u.ui.removeLock(),[7];case 5:return[2]}})})},t.prototype.destroyBlockToPoints=function(e){return c(this,void 0,Promise,function(){return s(this,function(){return e?(e.zIndex=f.ZINDEX.flyingBlocks,e.setParent(u.canvas),[2,new Promise(function(t){cc.tween(e).to(d.MathHelper.getRandomFloat(.2,.4),{position:cc.v3(e.getPosition().add(cc.v2(d.MathHelper.getRandomInt(2*-u.settings.getColWidth(),2*u.settings.getColWidth()),d.MathHelper.getRandomInt(2*-u.settings.getColWidth(),2*u.settings.getColWidth())))),scale:1.1,angle:d.MathHelper.getRandomInt(-1e3,1e3)},{easing:"circInOut"}).to(d.MathHelper.getRandomFloat(.2,.8),{position:cc.v3(u.ui.getWorldCoord(u.pointsLabel,u.canvas)),scale:.7},{easing:"circIn"}).call(function(){u.logic.addCollectedPoints(e.gTag),e.off(cc.Node.EventType.TOUCH_START),u.destroyBlock(e),t()}).start()})]):[2]})})},t.prototype.destroyBlock=function(e){var t;u.blocksPool.put(e),u.blocksOnStage.delete(null===(t=e)||void 0===t?void 0:t.gId)},t.prototype.winLose=function(e){return void 0===e&&(e=!0),c(this,void 0,void 0,function(){var t,o=this;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,,4,5]),u.ui.addLock(),t=[],u.blocksOnStage.forEach(function(e){return c(o,void 0,void 0,function(){return s(this,function(){return t.push(new Promise(function(t){cc.tween(e).to(.6,{position:cc.v3(e.x,e.y-1e3)}).call(function(){u.destroyBlock(e),t()}).start()})),[2]})})}),u.ui.shadow(u.shadow,!0),[4,Promise.all(t)];case 1:return n.sent(),[4,u.adaptGridCover(7,7)];case 2:return n.sent(),(t=[]).push(u.ui.toPositionXY(u.replay,0,-150,.3)),u.winLoseLabel.getComponent(cc.Label).string=e?"\u041f\u041e\u0411\u0415\u0414\u0410!":"\u041f\u0420\u041e\u0418\u0413\u0420\u0410\u041b!",t.push(u.ui.toPositionXY(u.winLoseLabel,0,230,.3)),[4,Promise.all(t)];case 3:return n.sent(),[3,5];case 4:return u.ui.removeLock(),[7];case 5:return[2]}})})},t.prototype.boomClip=function(e){var t=u.grid.getGridPoint(e.row,e.col);u.ui.playClip(u.bigBoom,{x:t.x,y:t.y+50},u.gridCoverNode,f.ZINDEX.boom).setParent(u.canvas)},t.prototype.lightingClip=function(e,t){var o=u.grid.getGridPoint(e.row,e.col),n=t?o.x:0,r=t?0:o.y,i=u.ui.playClip(u.lighting,{x:n,y:r},u.gridCoverNode,f.ZINDEX.boom);t&&(i.angle=90)},t.prototype.updateBombState=function(e){u.boosterBomb.color=e?cc.Color.YELLOW:cc.Color.WHITE},t.prototype.updateReshuffleCount=function(e){u.ui.blink(u.boosterReshuffle),u.ui.setText(u.boosterReshuffleLabel,e)},t.prototype.updateBombCount=function(e){u.ui.setText(u.boosterBombLabel,e)},t.prototype.updatePoints=function(e){u.progress.getComponent(cc.ProgressBar).progress=e.progress,u.ui.setText(u.pointsLabel,e.points),u.ui.pulse(u.movesLabel.parent)},t.prototype.updateMoves=function(e){u.ui.blink(u.movesBackground),u.ui.pulse(u.movesLabel),u.ui.setText(u.movesLabel,e)},t.prototype.onDestroy=function(){u.events.removeAll()},i([b(cc.Prefab)],t.prototype,"block",void 0),i([b(cc.Prefab)],t.prototype,"bigBoom",void 0),i([b(cc.Prefab)],t.prototype,"lighting",void 0),i([b(cc.SpriteFrame)],t.prototype,"block1",void 0),i([b(cc.SpriteFrame)],t.prototype,"block2",void 0),i([b(cc.SpriteFrame)],t.prototype,"block3",void 0),i([b(cc.SpriteFrame)],t.prototype,"block4",void 0),i([b(cc.SpriteFrame)],t.prototype,"bomb",void 0),i([b(cc.SpriteFrame)],t.prototype,"rocketh",void 0),i([b(cc.SpriteFrame)],t.prototype,"rocketv",void 0),i([g],t)}(cc.Component);o.default=_,cc._RF.pop()},{"../../enums/block":"block","../../enums/booster":"booster","../../enums/gameEvent":"gameEvent","../../enums/zIndexes":"zIndexes","../../helpers/mathHelper":"mathHelper","../../ioc/init":"init"}],mathHelper:[function(e,t,o){"use strict";cc._RF.push(t,"cefc0U95itIErSFrqehEm3J","mathHelper"),Object.defineProperty(o,"__esModule",{value:!0}),o.MathHelper=void 0;var n=function(){function e(){}return e.secondsToTime=function(e){e=Math.floor(e);var t=Math.floor((e-0)/60),o=e-0-60*t;return t<10&&(t="0"+t),o<10&&(o="0"+o),t+":"+o},e.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},e.getRandomFloat=function(e,t){return Math.random()*(t-e)+e},e.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},e.shuffleArrayInPlace=function(e){for(var t,o,n=e.length;0!==n;)o=Math.floor(Math.random()*n),n--,t=[e[o],e[n]],e[n]=t[0],e[o]=t[1];return e},e.clamp=function(e,t,o){return Math.max(t,Math.min(e,o))},e.getRandomEnum=function(e){var t=Object.keys(e).map(function(e){return Number(e)}).filter(function(e){return!isNaN(e)});return t[Math.floor(Math.random()*t.length)]},e}();o.MathHelper=n,cc._RF.pop()},{}],queue:[function(e,t,o){"use strict";cc._RF.push(t,"eae86kUbn9FdZ6j2UUYdHxA","queue"),Object.defineProperty(o,"__esModule",{value:!0}),o.Queue=void 0;o.Queue=function(){var e=this;this.data=[],this.enqueue=function(t){return e.data.push(t)},this.dequeue=function(){return e.data.shift()},this.count=function(){return e.data.length}},cc._RF.pop()},{}],service:[function(e,t,o){"use strict";cc._RF.push(t,"fb05055/KVKv6QEb9fGpDBy","service"),Object.defineProperty(o,"__esModule",{value:!0}),o.SERVICE=void 0,function(e){e.LogicService="LogicService",e.GameSettings="GameSettings",e.GameState="GameState",e.UI="UI",e.BlockGenerator="BlockGenerator",e.BlockInteractor="BlockInteractor",e.Events="EventEmitter",e.GridView="GridView"}(o.SERVICE||(o.SERVICE={})),cc._RF.pop()},{}],settingsScene:[function(e,t,o){"use strict";cc._RF.push(t,"56ae2Q+cRZImIX5uQnPBZx5","settingsScene");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c,s=e("../../ioc/init"),u=cc._decorator,l=u.ccclass,a=(u.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){(c=this).ui=s.getUI(),c.settings=s.getSettings(),c.play=cc.find("Canvas/play"),c.rows=cc.find("Canvas/boxes/rows"),c.cols=cc.find("Canvas/boxes/cols"),c.points=cc.find("Canvas/boxes/points"),c.moves=cc.find("Canvas/boxes/moves"),c.reshuffle=cc.find("Canvas/boxes/reshuffle"),c.bomb=cc.find("Canvas/boxes/bomb")},t.prototype.start=function(){c.initSettings(),c.ui.hoverButton(c.play),c.play.on(cc.Node.EventType.TOUCH_START,function(){c.ui.uiIsLocked()||c.scheduleOnce(function(){c.updateSettings(),c.ui.nextScene("Main")},.1)})},t.prototype.initSettings=function(){c.cols.children[1].getComponent(cc.EditBox).string=c.settings.getCols().toString(),c.rows.children[1].getComponent(cc.EditBox).string=c.settings.getRows().toString(),c.points.children[1].getComponent(cc.EditBox).string=c.settings.getTargetPoints().toString(),c.moves.children[1].getComponent(cc.EditBox).string=c.settings.getStartedMoves().toString(),c.reshuffle.children[1].getComponent(cc.EditBox).string=c.settings.getStartedBoosterReshuffle().toString(),c.bomb.children[1].getComponent(cc.EditBox).string=c.settings.getStartedBoosterBomb().toString()},t.prototype.updateSettings=function(){c.settings.setCols(Number(c.cols.children[1].getComponent(cc.EditBox).string)),c.settings.setRows(Number(c.rows.children[1].getComponent(cc.EditBox).string)),c.settings.setTargetPoints(Number(c.points.children[1].getComponent(cc.EditBox).string)),c.settings.setStartedMoves(Number(c.moves.children[1].getComponent(cc.EditBox).string)),c.settings.setStartedBoosterReshuffle(Number(c.reshuffle.children[1].getComponent(cc.EditBox).string)),c.settings.setStartedBoosterBomb(Number(c.bomb.children[1].getComponent(cc.EditBox).string))},i([l],t)}(cc.Component));o.default=a,cc._RF.pop()},{"../../ioc/init":"init"}],testService:[function(e,t,o){"use strict";cc._RF.push(t,"b9fd80La4hFnZ/6aOh01CWP","testService"),Object.defineProperty(o,"__esModule",{value:!0}),o.TestService=void 0;var n=function(){function e(){}return e.prototype.someWork=function(){console.log("some work")},e.prototype.trueResult=function(){return!0},e.prototype.getVec=function(e){return e.x},e}();o.TestService=n,cc._RF.pop()},{}],uiUtilsService:[function(e,t,o){"use strict";cc._RF.push(t,"c9d22ruhbVNQ6uWe3jF5jNe","uiUtilsService");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{u(n.next(e))}catch(t){i(t)}}function s(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}u((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.UiUtils=void 0;var i,c=e("../enums/zIndexes"),s=function(){function e(){this._uilocked=[],this._defaultEffectTime=.2,(i=this)._persistNode=cc.find("PersistNode"),cc.game.addPersistRootNode(i._persistNode);var e=i._persistNode.getComponent("PersistData");i._sceneTransistor=e.sceneTransistor,i._simpleSprite=e.simpleSprite}return e.prototype.uiIsLocked=function(){return i._uilocked.length>0},e.prototype.addLock=function(){i._uilocked.push(!0)},e.prototype.removeLock=function(){i._uilocked.pop()},e.prototype.nextScene=function(e){if(!i.uiIsLocked()){cc.log("start transition"),i.addLock();var t=cc.instantiate(i._sceneTransistor);t.opacity=0,t.zIndex=c.ZINDEX.transistor,i._persistNode.addChild(t),cc.tween(t).to(i._defaultEffectTime,{opacity:255}).call(function(){cc.director.loadScene(e,i.onSceneLaunched)}).start()}},e.prototype.onSceneLaunched=function(){cc.log("scene launched");var e=cc.find("PersistNode/Transistor");cc.tween(e).to(i._defaultEffectTime,{opacity:0}).call(function(){i.removeLock(),i._persistNode.removeChild(e)}).start()},e.prototype.createNode=function(e,t,o,n,r){var s,u;if(e instanceof cc.Prefab?(u=cc.instantiate(e),r&&(u.getComponent(cc.Sprite).spriteFrame=r)):e instanceof cc.SpriteFrame&&((u=cc.instantiate(i._simpleSprite)).getComponent(cc.Sprite).spriteFrame=e),o)o.addChild(u);else{var l=null===(s=cc.director.getScene())||void 0===s?void 0:s.getChildByName("Canvas");null==l||l.addChild(u)}return t&&u.setPosition(t.x,t.y),u.zIndex=null!=n?n:c.ZINDEX.default,u},e.prototype.toPosition=function(e,t,o){return void 0===o&&(o=i._defaultEffectTime),n(this,void 0,Promise,function(){return r(this,function(){return[2,new Promise(function(n){cc.tween(e).to(o,{position:cc.v3(null==t?void 0:t.getPosition())},{easing:"fade"}).call(function(){return n()}).start()})]})})},e.prototype.toPositionXY=function(e,t,o,c){return void 0===c&&(c=i._defaultEffectTime),n(this,void 0,Promise,function(){return r(this,function(){return[2,new Promise(function(n){cc.tween(e).to(c,{position:cc.v3(t,o,0)},{easing:"backOut"}).call(function(){return n()}).start()})]})})},e.prototype.setText=function(e,t){e.getComponent(cc.Label).string=t.toString()},e.prototype.blink=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return e.color=cc.Color.YELLOW,[4,i.sleep(200)];case 1:return t.sent(),e.color=cc.Color.WHITE,[2]}})})},e.prototype.getWorldCoord=function(e,t){return e.parent.convertToWorldSpaceAR(e.getPosition()).subtract(t.parent.convertToWorldSpaceAR(t.getPosition()))},e.prototype.pulse=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,i.tweenScale(e,1.1,.1)];case 1:return t.sent(),[4,i.tweenScale(e,1,.1)];case 2:return t.sent(),[2]}})})},e.prototype.tweenScale=function(e,t,o){return void 0===o&&(o=i._defaultEffectTime),new Promise(function(n){cc.tween(e).to(o,{scale:t},{easing:"fade"}).call(function(){return n()}).start()})},e.prototype.sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},e.prototype.hoverButton=function(e){var t=this;e.on(cc.Node.EventType.MOUSE_ENTER,function(){return n(t,void 0,void 0,function(){return r(this,function(){return i.uiIsLocked()||cc.tween(e).to(.15,{scale:1.1},{easing:"backOut"}).start(),[2]})})}),e.on(cc.Node.EventType.MOUSE_LEAVE,function(){return n(t,void 0,void 0,function(){return r(this,function(){return i.uiIsLocked()||cc.tween(e).to(.15,{scale:1},{easing:"backOut"}).start(),[2]})})})},e.prototype.shadow=function(e,t){i.addLock(),t?(e.addComponent(cc.BlockInputEvents),cc.tween(e).to(i._defaultEffectTime,{opacity:200},{easing:"fade"}).call(function(){return i.removeLock()}).start()):cc.tween(e).to(i._defaultEffectTime,{opacity:0},{easing:"fade"}).call(function(){i.removeLock(),e.getComponent(cc.BlockInputEvents)&&e.removeComponent(cc.BlockInputEvents)}).start()},e.prototype.playClip=function(e,t,o,n){var r=i.createNode(e,t,o,n);return r.getComponent(cc.Animation).play(),r},e}();o.UiUtils=s,cc._RF.pop()},{"../enums/zIndexes":"zIndexes"}],zIndexes:[function(e,t,o){"use strict";cc._RF.push(t,"cabf5KnxaxD0KTDkdR3WDY1","zIndexes"),Object.defineProperty(o,"__esModule",{value:!0}),o.ZINDEX=void 0,function(e){e[e.default=1e3]="default",e[e.blocks=1100]="blocks",e[e.flyingBlocks=1200]="flyingBlocks",e[e.boom=1250]="boom",e[e.movesNode=1300]="movesNode",e[e.transistor=31e3]="transistor"}(o.ZINDEX||(o.ZINDEX={})),cc._RF.pop()},{}]},{},["PersistData","BombBlock","NormalBlock","RocketHBlock","RocketVBlock","SuperBombBlock","block","blockType","booster","gameEvent","service","zIndexes","mathHelper","iBlockData","iGridElement","iInteractResponse","iInteractedBlock","iMove","iNode","iPoint","iQueue","iBlockGenerator","iBlockInteractor","iEventEmitter","iGameSettings","iGameState","iGridPointsService","iLogicService","iTestService","iUiUtils","container","init","BigBoom","queue","logoScene","mainScene","settingsScene","blockGenerator","blockInteractor","eventEmitter","gameSettings","gameState","gridPointsService","logicService","testService","uiUtilsService"]);